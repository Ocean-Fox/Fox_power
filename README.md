# 超电

## buck 降压电路

![image-20250214094503926.png](https://github.com/kily-smith/Kily_Power/blob/main/IMAGES/image-20250214094503926.png?raw=true)

*UP那里相当于一个开关（BOOST电路同理），高电平导通低电平断开。Ui为电源端，Uo为超级电容端。CE系列为电容（电容特点：电压无法突变），滤波作用。L1为电感（电感特点：电流无法突变）。*

**情况分析：** 当Up为高时，Q1导通。此时除了D1二极管那里的电路，其他路都导通。电容充电，L1充电，在电感没有饱和前，电感电流线性增加，电感储能。

​		当Up为低时，Q1断开，此时电路可以分为两部分。左半部分为Q1左，由于电压值相同，Ic1为0，左半部分断路。右半部分电感L1个电容CE2释放能量经过整流二极管为负载供电，整流二极管正向导通。

**波形分析：** 由上述分析画出如下图所示的先关波形，Q1导通期间电感L1储存能量，Q1截止期 间电感L1释放能量，**根据整个开关周期内电感电流是否存在零点**，即上一周期储存的能量在下一周期到了之前，电感L1储存的能量是否完成释放，电感电流减小为零，可将BUCK电路的工作模式分为**连续工作模式**和**不连续工作模式**，要使BUCK电路工作稳定需要工作在连续工作模式下，以下将着重分析连续工作模式下的波形：

![image-20250214094610475](https://github.com/kily-smith/Kily_Power/raw/main/IMAGES/image-20250214094610475.png)

即在电路能量未全部耗尽的情况下切换Up的高低电平。



## BOOST升压电路

![image-20250214094625489](https://github.com/kily-smith/Kily_Power/raw/main/IMAGES/image-20250214094625489.png)

**情况分析：** 当Up为高电平时，Q1导通，此时左半边电路经过Q1回去，L1充能，电感电流线性增加，不经过D1（不到达右侧），右半边电路通过CE2提供能量。

​		当Up为低电平时，Q1断开，此时左右电路打通，L1与电源一起为整个电路提供电流。

**波形分析：**和经典BUCK电路相同，根据电感电流在一个开关周期内是否为零，可将BOOST 电路的工作模式分为连续工作模式和不工作连续模式，如图6所示为BOOST电路在连续工作模式 和不工作连续模式下的波形。在连续工作模式下，电感电流纹波为△I;在电感足够大的情况下，电流增加量等于电流减少量。

![image-20250214094637246](https://github.com/kily-smith/Kily_Power/raw/main/IMAGES/image-20250214094637246.png)

## 双向同步整流BUCK—BOOST电路

双向同步整流BUCK-BOOST电路由同步BUCK电路和同步BOOST电路级联而成。

BUCK-BOOST电路电压增益公式：
$$
\frac{U_o}{U_i}=\frac{D_{BU}}{1-D_{BD}}
$$
**其中，U<sub>o</sub> 为电源电压（会从24V降压到21V左右，根据电压采集器读值），U<sub>i</sub> 为超电电压，这一部分电压为目标控制电压，时刻都在变化。**

双向同步整流BUCK-BOOST电路根据输入输出的电压关系将 电路工作状态分为降压区、升压区和降压-升压区；

当输出电压显著小于输入电压时，电路工作在降压区，此时Q1和Q2互补导通，Q4常关Q3常通，电路等效于同步BUCK电路；



![image-20250305211324625](C:\Users\User\AppData\Roaming\Typora\typora-user-images\image-20250305211324625.png)

实际应用中由于MOS 管驱动采用自举升压的方式，Q4不能始终截止，否则当Q3的自举电容能量损耗完时，Q3将截止； 为驱动Q3，Q4必须导通一小段时间为Q3的自举电容充电以驱动Q3。因此在实际控制中<mark>可将Q4的占空比固定设为0.05（即B<sub>OD</sub>可根据实际情况调整）</mark>，而Q1的占空比B<sub>UD</sub>可在0-0.95之间变化，如此电路将一直工作在降压区。

当输出电压显著大于输入电压时，电路工作在升压区，此时Q3和Q4互补导通，Q1常关Q2常通，等效于同步BOOST 电路。

和电路工作在降压区的情况类似，Q2不能始终截止，需要导通一小段时间为Q1的自举电容充电，因此在实际控制中可将Q1的占空比B<sub>UD</sub>固定设置为0.95（可根据实际情况调整），而Q4的 占空比可在0-0.95之间变化，如此电路将一直工作在升压区。

当输出电压和输入电压接近时，电路 工作在降压-升压区，即在一个周期内一段时间按降压方式工作，一段时间按升压方式工作。

![image-20250214094719926](https://github.com/kily-smith/Kily_Power/raw/main/IMAGES/image-20250214094719926.png)

当MOS管在A、B状态之间切换时，电路工作在降压模式；当MOS管在B、C状态之间切换 时，电路工作在升压模式；当MOS管按照状态A-B-C-B-A的顺序却换时，电路工作在降压-升压模式。如下图所示为电路工作在降压-升压模式时的驱动波形和电感电流波形。**降压-升压模式一般会出现在电压保持情况。**

## 信号调理电路

### 1.电流采样电路

 电流检测芯片使用INA240，这是一款使用较为广泛具有PWM 抑制的双向电流检测芯片。

根据INA240芯片手册应用双向电流测量8.4.3.3将输出设置为1/2的参考电压

![image-20250205175900023](https://github.com/kily-smith/Kily_Power/raw/main/IMAGES/image-20250205175900023.png)

![image-20250205180310355](https://github.com/kily-smith/Kily_Power/raw/main/IMAGES/image-20250205180310355.png)

![image-20250205180310355](https://github.com/kily-smith/Kily_Power/raw/main/IMAGES/image-20250205180310355.png)

考虑到电源管理模块底盘端口额定电流为10A，最大电流30A持续500ms。一般情况下，电源管理模块输出的电流不超过5A，可以使用较大的采样电阻也不会有太大的功率损失。使用1mR，搭配50倍增益，当经流过电流为30A时，采样电阻两端压差为1mR * 30A=0.03V，100倍增益到MCU的ADC处为1/2VREF±0.03V * 50=3.15Vor0.15V，满足采样要求，但是由于采样范围广，导致采样精度较低。

故采样电阻使用1mR搭配50倍的增益的INA240A2进行采样，所以最大采样电流设置为±30A。

### 2.电压采样

电压主要采集为电池端输入电压及经过FSBB变换后的输出电压即超级电容端的电压，一方面为了功率闭环，另一方面为了估计电容剩余电压。

![image-20250305235742817](C:\Users\User\AppData\Roaming\Typora\typora-user-images\image-20250305235742817.png)

### 3.系统参数

ADC_V_IN ADC_V_CAP 分别为FSBB输入电压及输出到超级电容端的电压

ADC_I_IN ADC_I_CHASSIS ADC_I_WPT 分别为输入总电流 底盘输出电流 及无线充电电流（不考虑无线供电部分，超级电容输入电流为I_CAP=I_IN—I_CHASSIS）

在不考虑无线供电部分，系统各个功率如下：

输入功率为裁判系统(电源) 输入功率P_IN=V_IN* I_IN

底盘输出功率P_CHASSIS=V_IN* I_CHASSIS

FSBB输入功率为P_DCDC=V_IN* I_CAP

超级电容充放电功率为P_CAP=V_CAP* I_CAP



![image-20250306002559889](C:\Users\User\AppData\Roaming\Typora\typora-user-images\image-20250306002559889.png)

*根据功率守恒有：裁判系统输出功率 = 底盘功率 + 超级电容输出功率。裁判系统的输出功率是由底盘和超级电容决定的。 最理想的工作状态是裁判系统恒定以刚好不掉血的限制功率输出，**当底盘功率小于限制功率时超级电容充电来吸收多余的功率，当底盘功率大于限制功率时超级电容放电来提供多余的功率。这样可以使一场比赛中机器人使用的总能量达到最大**。 超级电容会检测裁判系统当前输出功率和能量缓冲，自动调节电容的充电或放电功率，使裁判系统输出功率维持在限制功率。 但是，超级电容吸收和放出功率的能力是有极限的。当电容充满电时，就不能吸收裁判系统富余的功率；当电容放完电时，就不能提供额外的功率给底盘。另外，电容的最大充放电功率与电容当前电压有关。 当电容的最大放电功率不够时，会以能达到的最大功率放电，此时裁判系统输出功率会升高并超过限制功率，消耗能量缓冲，这时需要功率算法限制底盘功率防止超功率扣血。 目前，超级电容会使裁判系统的能量缓冲稳定在50J，所以需要将**功率算法**调节到当能量缓冲低于40J时开始限制底盘输出。 如果想要超级电容快速充电，可以限制底盘功率或限制超级电容输出功率，注意**要加速的时候不要忘记解除输出功率限制**。 电容当前存储的能量，<mark>能量E与电压u的平方成正比</mark>。 另外，<mark>电容的最大输出功率与电容当前电压正相关</mark>，也就是说，电容电压不同时底盘能达到的最大功率也不同。之前我驱动底盘时基本没有关注过它各个速度下的功率，只是简单的设一个能超过功率限制的速度让它跑，然后再通过能量缓冲限制速度环输出的电流大小。这样在加了超级电容之后是不太好的，由于超级电容最大输出功率会变化，它不同时刻跑的功率和速度不一样。 所以加了超级电容之后测试机器人需要考虑它的功率曲线。比如说某个动作的某个时刻的功率超过裁判系统限制功率，需要电容提供额外输出功率时，电容当前的最大输出功率就决定了当前动作能否按照预期实现。* 



### 一些补充

在你的电路中，**输入端是电源，输出端是电容**，那么电容的充放电情况可以这样分析：

1. **BUCK 模式（降压模式）**：
   - 适用于 **输入电压 > 输出电压** 的情况。
   - BUCK 开关管调节占空比，降低电压，并通过电感为电容充电。
   - **电容充电**：在 BUCK 模式下，电容主要从输入电源获取能量，并存储电荷。
2. **BUCK-BOOST 模式（升降压模式）**：
   - 适用于 **输入电压 < 输出电压** 的情况。
   - BOOST 开关管调节占空比，提高电压，给输出电容供电。
   - 在某些情况下，如果 BOOST 开关管关闭时间较长，电容可能会放电到负载。
   - **电容充电 or 放电**：在 BUCK-BOOST 模式下，电容可能会被电源充电（升压阶段），但在某些工作模式下，也可能向负载放电。

### 结论：

- **BUCK 模式** 主要是 **给电容充电**（因为输入电压较高，通过 BUCK 电路调节后为电容供电）。
- **BUCK-BOOST 模式** 可能既**充电**也**放电**，具体取决于占空比调节和负载情况，但通常是 **维持输出电压**，如果 BOOST 占空比不足，电容可能会放电。
